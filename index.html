<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mi primer Juego</title>
    <style>
        #juego {
            width: 480px;
            height: 320px;
            position: relative;
        }
        #canvas {
            background-color: aquamarine;
            border: 1px solid;
        }
        #modal {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        #boton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
        }
    </style>
</head>
<body>
    <h1>Jugando Ando para MARLON </h1>
    <div id="juego">
        <canvas id="canvas" width="480" height="320"></canvas>
      <div id="modal"><button id="boton">Play</button></div>
    </div>
    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var vidas = 3;
        var puntaje = 0;
        var nivel = 0;
        var boton = document.getElementById("boton");
        boton.addEventListener("click", iniciarJuego);
//ADD: mesa
        var mw =  70;
        var mh = 10;
        var mx = (canvas.width/2)- (mw/2);
        var my = 300;
        var derecha = false;
        var izquierda = false;
        var velocidad = 7;
            
        function dibujarMesa() {
            ctx.fillStyle = "red";
            ctx.fillRect(mx, my, mw, mh);

        };
        
        function moverMesa() {
            if (izquierda && mx < canvas.width - mw){
                mx += velocidad;
            }
            if (derecha && mx> 0){
                mx -=velocidad;
            }
            
        };
        document.addEventListener("keydown", function () {
            if(event.keyCode == 39){
                izquierda = true;
            }
            if(event.keyCode == 37){
                derecha = true;
            }
        });
        document.addEventListener("keyup", function () {
            if(event.keyCode == 39){
                izquierda = false;
            }
            if(event.keyCode == 37){
                derecha = false;
            }
        });
        function rebotaMesa() {
            
        }
//ADD: fin de la mesa
// pelota
        var px = 240;
        var py = 160;
        var r = 10;
        var pxDir= 2;
        var pyDir = 2;

        function dibujarPelota() {
            ctx.fillStyle = "blue";
            ctx.beginPath();
            ctx.arc(px, py, r, 0, Math.PI*2);
            ctx.fill();
        }

        function moverPelota() {
            px += pxDir;
            py += pyDir;
            
            
        }
// fin pelota

        function aumentarNivel() {
            
        };
        function dibujarInfo() {
            ctx.fillStyle = "black";
            ctx.fillText("Vidas Restantes: " + vidas, 5, 15);
            ctx.fillText("nivel: "+ nivel, 430, 15);
        }

        function dibujar() {
            ctx.clearRect(0,0, 480, 320);
            dibujarPelota();
            dibujarMesa();
            dibujarInfo();
            
        };

        function actualizar() {
            moverMesa();
            moverPelota();
        };

        function colision() {
            // if (px<=r || px >= 480-r){
            //     pxDir = -pxDir;
            // };
            if (px<=0 || px>= canvas.width - r){pxDir *=-1;};

            // if (py<=0){
            //     pyDir = -pyDir;
            // };
            if (py<=0 /*|| py>=canvas.height- r*/){pyDir *=-1;};
            if (py>=canvas.height- r){ 
                if (py>mx && py <my){
                    alert("prueba")
                } else { alert("no paso")}
            }
            };
                       
            // if (py<=0 || py>=canvas.height- r){pyDir *=-1;};
            // if (py >= 320 - r){
            //     // pyDir = -pyDir;
            //     if (!px>mx && py<my){
            //         perderVida();
            //     }
            // }
        // };
        function perderVida() {
            if (vidas>0){
                alert("Perdiste 1 Vida");
                vidas --;
            }else {
                alert ("Se Acab√≥")
             finJuego();   
            }
        }

        function animacion() {
            actualizar();
            colision();
            dibujar();
            requestAnimationFrame(animacion);
        }

        function iniciarJuego() {
            var modal= document.getElementById("modal");
            modal.style.display = "none";
            animacion();
        }

        function finJuego() {
            document.location.reload();
        }
    </script>
   
</body>
</html>

 <!-- PENDIENTES: no esta detectando colision con mesa, debo revisar -->







